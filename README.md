## VIOS

### Intro
VIOS Is an Operating System Is an Operating System ...

一个操作系统内核，读音和希腊语βίος（生命）一样，但其实并没有什么意思，单纯为了凑出个OS出来而已。

### Usage
执行`make image`命令即可得到软盘镜像文件vios.img和硬盘镜像文件80m.img。可放在虚拟机测试。实测qemu和bochs都能运行。如果用bochs测试，输入命令`bochs`即可（首先得有bochs）。

### 设计实现
#### 1.进程调度
进程调度是模仿Linux2.6.0的O(1)进程调度算法。详细的介绍看[进程调度实现](http://www.kakit.top/wordpress/index.php/2017/02/10/makeos13/)。

#### 2.内存分配
在bochsrc中设定的内存为1024M也就是1G内存。系统的内存分配情况是：前10M是固定分配给内核任务的，10M到128M是动态分配的区域，使用buddy伙伴算法。剩余的是分配给用户进程的。

#### 3.设备管理
设备管理包括块设备管理和字符设备的管理，其中块设备主要是硬盘，字符设备主要是键盘等。
硬盘管理的主要任务是读写硬盘，方法是通过寄存器访问外部设备，包括控制寄存器、状态寄存器与数据寄存器三类，分别用于发送命令、读取状态、读写数据。
键盘管理主要是通过寄存器0x60和0x64来读和控制的。因为有可能处理的速度跟不上输入的速度，所以用循环队列实现一个缓冲区。对读入的码，分开成控制码和显示字符，分别进行不同的处理

#### 4.终端
终端是通过对VGA控制器的操作来实现的，对内存0x8b000之后的640X480个字节进行修改就能在显示器上显示相关内容。可以视为一个二维数组，一个屏幕显示80*25个字符。可以通过向0x3D4与0x3D5两个端口写入内容实现改变屏幕开始的地址和光标的地址，从而实现滚屏和光标移动。

#### 5.文件系统
文件系统的作用是提供一个方便用户管理文件的接口，本系统的文件系统主要有引导块，超级块，inode位图，sector位图，inode区域和数据区域六个部分组成。其中超级块是存放着文件系统的一些信息，比如inode数量等。inode位图中一个位对应一个inode区域中的inode结构，用来实现分配空闲的inode。sector位图中一个位对应硬盘上一个512字节的块，用来分配空闲的硬盘空间。inode区域存放着inode结构，inode也就是索引节点，用来指向一块文件数据区域的，并保存着文件的权限等相关信息，一个inode就代表了一个文件。数据区域就是所有文件的实际数据保存点。

